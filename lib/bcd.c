#include <math.h>
#include <stdio.h>
#include <string.h>



//-------------------------------------------------------------------------
//
//-------------------------------------------------------------------------
u8 bcd2bin8(u8 x)
{

	return (x & 0x0F) + (x >> 4) * 10;
}

//-------------------------------------------------------------------------
//
//-------------------------------------------------------------------------
u8 bin2bcd8(u8 x)
{

	return ((x / 10) << 4) + x % 10;
}

//-------------------------------------------------------------------------
//
//-------------------------------------------------------------------------
u16 bin2bcd16(u16 x)
{
	int i;
	char str[5 + 1];
	u_byte2 bcd;

	sprintf(str, "%05u", x);
	for (i = 1;  i < 3;  i++)
	{
		bcd.byte[2 - i] = ((str[2 * i - 1] & 0x0F) << 4) | (str[2 * i] & 0x0F);
	}

	return bcd.n;
}

//-------------------------------------------------------------------------
//
//-------------------------------------------------------------------------
u16 bcd2bin16(u16 x)
{
	int i;
	u16 y = 0, nTemp;
	u8 *p = (u8 *)&x;

	for (i = 0; i < 2; i++)
	{
		nTemp = p[i];
		y += ((u16)(nTemp & 0x0F) * (u16)math_pow10[i * 2]);
		y += ((u16)((nTemp >> 4) & 0x0F) * (u16)math_pow10[i * 2 + 1]);
	}
	return y;
}

//-------------------------------------------------------------------------
//
//-------------------------------------------------------------------------
u32 bin2bcd32(u32 x)
{
	int i;
	char str[10 + 1];
	u_byte4 bcd;

	sprintf(str, "%010u", x);
	for (i = 1;  i < 5;  i++)
	{
		bcd.byte[4 - i] = ((str[2 * i] & 0x0F) << 4) | (str[2 * i + 1] & 0x0F);
	}

	return bcd.n;
}

//-------------------------------------------------------------------------
//
//-------------------------------------------------------------------------
u32 bcd2bin32(u32 x)
{
	int i;
	u32 y = 0, nTemp;
	u8 *p = (u8 *)&x;

	for (i = 0; i < 4; i++)
	{
		nTemp = p[i];
		y += ((u32)(nTemp & 0x0F) * (u32)math_pow10[i * 2]);
		y += ((u32)((nTemp >> 4) & 0x0F) * (u32)math_pow10[i * 2 + 1]);
	}
	return y;
}

//-------------------------------------------------------------------------
//
//-------------------------------------------------------------------------
u64 bin2bcd64(u64 x)
{
	u64 i, power;
	u8 bcd[8];
	int n1, n2;

	power = 10000000000000000ULL;

	for (i = 8; i; i--)
	{
	    x %= power;
	    power /= 10;
		n1 = x / power;

	    x %= power;
	    power /= 10;
		n2 = x / power;

		bcd[i - 1] = (n1 << 4) | n2;
	}
	
	memcpy(&i, bcd, sizeof(i));
	return i;
}


//-------------------------------------------------------------------------
//
//-------------------------------------------------------------------------
int isnotbcd(const void *pAdr, size_t nLen)
{
	int i;
	u8 *p, nTemp;

	p = (u8 *)pAdr;
	for (i = 0; i < nLen; i++)
	{
		nTemp = bcd2bin8(p[i]);
		nTemp = bin2bcd8(nTemp);
		if (nTemp != p[i])
			break;
	}

	return (i < nLen) ? 1 : 0;
}


